import{k as I,a as e,A as V,d as x,s as z,l as K,m as A,n as Q,b as u,f as R,o as S,c as B,w as r,F as j,e as T,g as $,q as W,h as P,v as H,x as N,t as G,i as U,p as X,j as Y,_ as J,R as D,r as Z,y as ee}from"./index-0d1b7ab7.js";const te=async(o,s={})=>{let a=[],l=1;const t=100;try{const _=async()=>{const h=await o({...s,page:l,perPage:t});return a=a.concat(h),h.length<t?a:(l++,await _())};await _()}catch(_){console.error(`${o} error`,_)}return a};I();const ae=I(),ne=async o=>{const{id:s,...a}=o;return(await ae.api.get(`/projects/${s}/repository/branches`,{params:a})).data},oe=o=>te(ne,{id:o}),se=I(),re=async o=>(await se.api.get(`/users?search=${o}`)).data,ie=I(),le=async o=>{const{id:s,...a}=o;return(await ie.api.post(`/projects/${s}/merge_requests`,a)).data};var ce={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"};const ue=ce;function F(o){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?Object(arguments[s]):{},l=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(t){return Object.getOwnPropertyDescriptor(a,t).enumerable}))),l.forEach(function(t){de(o,t,a[t])})}return o}function de(o,s,a){return s in o?Object.defineProperty(o,s,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[s]=a,o}var E=function(s,a){var l=F({},s,a.attrs);return e(V,F({},l,{icon:ue}),null)};E.displayName="MinusCircleOutlined";E.inheritAttrs=!1;const pe=E,_e=o=>(X("data-v-51cf7205"),o=o(),Y(),o),me={key:0,class:"mr-page"},fe=["href"],ge=_e(()=>U("br",null,null,-1)),he=x({__name:"CreateMR",setup(o){const s=I(),{hasAuth:a,repoList:l}=z(s),t=K(()=>l.value.map(d=>({value:d.id,label:d.name}))),_=(d,p)=>p.label.toLowerCase().indexOf(d.toLowerCase())>=0,h=(d,p)=>p.value.toLowerCase().indexOf(d.toLowerCase())>=0,n=A({mrList:[{repoId:void 0,sourceBranch:void 0,targetBranch:["master","uat"],branchOptions:[],loading:!1}],assigneeIds:[],userList:[],fetching:!1,mrTextLink:[],btnLoading:!1}),w=async d=>{const p=n.mrList[d];if(p.loading=!0,p!=null&&p.repoId){const c=(await oe(p.repoId)).map(g=>({...g,value:g.name}));p.loading=!1,n.mrList.splice(d,1,{...p,branchOptions:c})}},M=()=>{n.mrList.push({repoId:void 0,sourceBranch:void 0,targetBranch:["master","uat"],branchOptions:[],loading:!1})},k=d=>{n.mrList.splice(d,1)},f=Q.debounce(async d=>{n.fetching=!0,n.userList=await re(d),n.fetching=!1},300),q=async()=>{var p,v;if(!n.mrList.length){N.error("Please input the MR!");return}n.btnLoading=!0;const d=[];n.mrList.forEach(c=>{const{repoId:g,sourceBranch:b="",targetBranch:m}=c;let y=b;{const[C,i]=b.split("/").slice(-2);y=`[${C}] ${i.split("-").join(" ")}`}m.forEach(C=>{d.push(le({id:g,sourceBranch:b,targetBranch:C,title:y,assigneeIds:n.assigneeIds}))})});try{const c=await Promise.all(d);c.sort((g,b)=>{const m=g.targetBranch.toUpperCase(),y=b.targetBranch.toUpperCase();return m<y?-1:m>y?1:0}),n.mrTextLink=c.map(g=>{var i;const{targetBranch:b,projectId:m,webUrl:y}=g,C=(i=l.value.find(L=>L.id===m))==null?void 0:i.name;return{targetBranch:b,projectName:C,webUrl:y}}),n.btnLoading=!1,N.success("Create MR success!")}catch(c){N.error(((v=(p=c==null?void 0:c.response)==null?void 0:p.data)==null?void 0:v.message)||"failed")}};return(d,p)=>{const v=u("a-select"),c=u("a-form-item"),g=u("a-button"),b=u("a-spin"),m=u("a-form"),y=u("a-card"),C=u("a-alert");return R(a)?(S(),B("div",me,[e(m,{model:n,onFinish:q},{default:r(()=>[(S(!0),B(j,null,T(n.mrList,(i,L)=>(S(),B("div",{class:"item",key:L},[e(c,{name:["mrList",L,"repoId"],rules:[{required:!0,message:"Repo is required!"}]},{default:r(()=>[e(v,{"show-search":"",placeholder:"Select a repo",value:i.repoId,"onUpdate:value":O=>i.repoId=O,options:R(t),"filter-option":_,onChange:O=>w(L)},null,8,["value","onUpdate:value","options","onChange"])]),_:2},1032,["name"]),e(c,{name:["mrList",L,"sourceBranch"],rules:[{required:!0,message:"SourceBranch is required!"}]},{default:r(()=>[e(v,{"show-search":"",placeholder:"Select sourceBranch",value:i.sourceBranch,"onUpdate:value":O=>i.sourceBranch=O,loading:i.loading,options:i.branchOptions,"filter-option":h},null,8,["value","onUpdate:value","loading","options"])]),_:2},1032,["name"]),e(c,{name:["mrList",L,"targetBranch"],rules:[{required:!0,message:"TargetBranch is required!"}]},{default:r(()=>[e(v,{mode:"multiple",placeholder:"Select targetBranch",value:i.targetBranch,"onUpdate:value":O=>i.targetBranch=O,loading:i.loading,options:i.branchOptions,"filter-option":h},null,8,["value","onUpdate:value","loading","options"])]),_:2},1032,["name"]),e(c,{class:"action"},{default:r(()=>[e(R(pe),{onClick:O=>k(L)},null,8,["onClick"])]),_:2},1024)]))),128)),e(c,null,{default:r(()=>[e(g,{type:"dashed",onClick:M},{default:r(()=>[$("Add")]),_:1})]),_:1}),e(c,{name:"assigneeIds",rules:[{required:!0,message:"Assignee is required!"}]},{default:r(()=>[e(v,{class:"select-assignee",mode:"multiple",placeholder:"Select Assignee",value:n.assigneeIds,"onUpdate:value":p[0]||(p[0]=i=>n.assigneeIds=i),options:n.userList,"field-names":{label:"username",value:"id"},"filter-option":!1,"not-found-content":n.fetching?void 0:null,onSearch:R(f)},W({_:2},[n.fetching?{name:"notFoundContent",fn:r(()=>[e(b,{size:"small"})]),key:"0"}:void 0]),1032,["value","options","not-found-content","onSearch"])]),_:1}),e(c,null,{default:r(()=>[e(g,{type:"primary","html-type":"submit",loading:n.btnLoading},{default:r(()=>[$(" Create MR ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),n.mrTextLink.length?(S(),P(y,{key:0,title:"MR Text Link"},{default:r(()=>[(S(!0),B(j,null,T(n.mrTextLink,(i,L)=>(S(),B("span",{key:L},[$(G(`[${i.targetBranch}]${i.projectName}`)+": ",1),U("a",{href:i.webUrl,target:"_blank"},G(i.webUrl),9,fe),ge]))),128))]),_:1})):H("",!0)])):(S(),P(C,{key:1,type:"warning",message:"Please fill your Gitlab host and token in Settings page first!"}))}}});const ve=J(he,[["__scopeId","data-v-51cf7205"]]),be={key:0},ye=["onClick"],Se=["onClick"],ke=x({__name:"MyRepo",setup(o){const s=[{title:"Repo ID",dataIndex:"id",key:"id"},{title:"Repo Name",dataIndex:"name",key:"name"},{title:"Action",key:"action"}],a=I(),{repoList:l}=z(a),t=A({visible:!1,repoState:{id:null,name:""},isEdit:!1,editIndex:0}),_=()=>{t.repoState={id:null,name:""},t.isEdit=!1},h=()=>{t.isEdit?l.value.splice(t.editIndex,1,t.repoState):l.value.push(t.repoState),localStorage.setItem(D,JSON.stringify(l.value)),t.visible=!1,_()},n=(k,f)=>{t.repoState=JSON.parse(JSON.stringify(k)),t.editIndex=f,t.visible=!0,t.isEdit=!0},w=k=>{l.value.splice(k,1),localStorage.setItem(D,JSON.stringify(l.value))},M=k=>{t.repoState.id=+k.target.value};return(k,f)=>{const q=u("a-button"),d=u("a-divider"),p=u("a-table"),v=u("a-input"),c=u("a-form-item"),g=u("a-form"),b=u("a-modal");return S(),B(j,null,[e(q,{type:"primary",onClick:f[0]||(f[0]=m=>t.visible=!0)},{default:r(()=>[$("Add Repo")]),_:1}),e(p,{class:"repo-list",columns:s,"data-source":R(l)},{bodyCell:r(({column:m,record:y,index:C})=>[m.key==="action"?(S(),B("span",be,[U("a",{onClick:i=>n(y,C)},"Edit",8,ye),e(d,{type:"vertical"}),U("a",{onClick:i=>w(C)},"Delete",8,Se)])):H("",!0)]),_:1},8,["data-source"]),e(b,{title:`${t.isEdit?"Edit":"Add"} Repo`,visible:t.visible,"onUpdate:visible":f[2]||(f[2]=m=>t.visible=m),onOk:h,onCancel:_},{default:r(()=>[e(g,{model:t.repoState,name:"settings",layout:"vertical",autocomplete:"off"},{default:r(()=>[e(c,{label:"Repo ID",name:"id",rules:[{required:!0,message:"Please input your Repo ID!"}]},{default:r(()=>[e(v,{type:"number",value:t.repoState.id,onChange:M},null,8,["value"])]),_:1}),e(c,{label:"Repo Name",name:"name",rules:[{required:!0,message:"Please input your Repo Name!"}]},{default:r(()=>[e(v,{value:t.repoState.name,"onUpdate:value":f[1]||(f[1]=m=>t.repoState.name=m)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","visible"])],64)}}});const Ce=J(ke,[["__scopeId","data-v-9b07b28d"]]),Le=x({__name:"Settings",setup(o){const s=I(),a=A({host:s.host,token:s.token}),l=t=>{s.saveSettings(t)};return(t,_)=>{const h=u("a-input"),n=u("a-form-item"),w=u("a-input-password"),M=u("a-button"),k=u("a-form");return S(),P(k,{model:a,name:"settings",layout:"vertical",autocomplete:"off",onFinish:l},{default:r(()=>[e(n,{label:"Host",name:"host",rules:[{required:!0,message:"Please input your Host!"}]},{default:r(()=>[e(h,{value:a.host,"onUpdate:value":_[0]||(_[0]=f=>a.host=f),placeholder:"Gitlab Instance Host URL"},null,8,["value"])]),_:1}),e(n,{label:"Token",name:"token",rules:[{required:!0,message:"Please input your Token!"}]},{default:r(()=>[e(w,{value:a.token,"onUpdate:value":_[1]||(_[1]=f=>a.token=f),placeholder:"Personal Access Token"},null,8,["value"])]),_:1}),e(n,null,{default:r(()=>[e(M,{type:"primary","html-type":"submit"},{default:r(()=>[$("Save")]),_:1})]),_:1})]),_:1},8,["model"])}}}),Ie=x({__name:"Git",setup(o){const s=I(),a=Z("CreateMR");return ee(()=>{s.initApi()}),(l,t)=>{const _=u("a-tab-pane"),h=u("a-tabs");return S(),P(h,{activeKey:a.value,"onUpdate:activeKey":t[0]||(t[0]=n=>a.value=n)},{default:r(()=>[e(_,{key:"CreateMR",tab:"Create MR"},{default:r(()=>[e(R(ve))]),_:1}),e(_,{key:"MyRepo",tab:"My Repo"},{default:r(()=>[e(R(Ce))]),_:1}),e(_,{key:"Settings",tab:"Settings"},{default:r(()=>[e(R(Le))]),_:1})]),_:1},8,["activeKey"])}}});export{Ie as default};
