import{k as O,a as e,A as Z,d as j,s as F,l as W,m as ee,n as H,q as te,b as c,f as R,o as g,c as L,w as s,F as E,e as A,g as I,v as ae,h as P,x as X,y as D,t as G,i as N,p as z,j as J,_ as V,R as Y,M as ne,E as oe,r as se}from"./index-519828a9.js";const re=async(a,r={})=>{let n=[],l=1;const t=100;try{const i=async()=>{const y=await a({...r,page:l,perPage:t});return n=n.concat(y),y.length<t?n:(l++,await i())};await i()}catch(i){console.error(`${a} error`,i)}return n};O();const ce=O(),le=async a=>{const{id:r,...n}=a;return(await ce.api.get(`/projects/${r}/repository/branches`,{params:n})).data},ie=a=>re(le,{id:a}),ue=O(),de=async a=>(await ue.api.get(`/users?search=${a}`)).data,pe=O(),_e=async a=>{const{id:r,...n}=a;return(await pe.api.post(`/projects/${r}/merge_requests`,n)).data};var me={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"};const fe=me;function Q(a){for(var r=1;r<arguments.length;r++){var n=arguments[r]!=null?Object(arguments[r]):{},l=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),l.forEach(function(t){ve(a,t,n[t])})}return a}function ve(a,r,n){return r in a?Object.defineProperty(a,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):a[r]=n,a}var K=function(r,n){var l=Q({},r,n.attrs);return e(Z,Q({},l,{icon:fe}),null)};K.displayName="MinusCircleOutlined";K.inheritAttrs=!1;const ge=K,he=a=>(z("data-v-2a816531"),a=a(),J(),a),ye={key:0,class:"mr-page"},be=["href"],ke=he(()=>N("br",null,null,-1)),Se=j({__name:"CreateMR",setup(a){const r=O(),{hasAuth:n,repoList:l}=F(r);W(()=>{});const t=ee(()=>l.value.map(p=>({value:p.id,label:p.name}))),i=(p,u)=>u.label.toLowerCase().indexOf(p.toLowerCase())>=0,y=(p,u)=>u.value.toLowerCase().indexOf(p.toLowerCase())>=0,o=H({mrList:[{repoId:void 0,sourceBranch:void 0,targetBranch:["master","uat"],branchOptions:[],loading:!1}],assigneeIds:[],userList:[],fetching:!1,mrTextLink:[],btnLoading:!1}),$=async p=>{const u=o.mrList[p];if(u.loading=!0,u!=null&&u.repoId){const d=(await ie(u.repoId)).map(v=>({...v,value:v.name}));u.loading=!1,o.mrList.splice(p,1,{...u,branchOptions:d})}},B=()=>{o.mrList.push({repoId:void 0,sourceBranch:void 0,targetBranch:["master","uat"],branchOptions:[],loading:!1})},b=p=>{o.mrList.splice(p,1)},f=te.debounce(async p=>{o.fetching=!0,o.userList=await de(p),o.fetching=!1},300),U=async()=>{var u,h;if(!o.mrList.length){D.error("Please input the MR!");return}o.btnLoading=!0;const p=[];o.mrList.forEach(d=>{const{repoId:v,sourceBranch:m="",targetBranch:k}=d;let S=m;{const[w,q]=m.split("/").slice(-2);S=`[${w}] ${q.split("-").join(" ")}`}k.forEach(w=>{p.push(_e({id:v,sourceBranch:m,targetBranch:w,title:S,assigneeIds:o.assigneeIds}))})});try{const d=await Promise.all(p);d.sort((v,m)=>{const k=v.targetBranch.toUpperCase(),S=m.targetBranch.toUpperCase();return k<S?-1:k>S?1:0}),o.mrTextLink=d.map(v=>{var _;const{title:m,targetBranch:k,projectId:S,webUrl:w}=v,q=(_=l.value.find(M=>M.id===S))==null?void 0:_.name;return{title:m,targetBranch:k,projectName:q,webUrl:w}}),o.btnLoading=!1,D.success("Create MR success!")}catch(d){D.error(((h=(u=d==null?void 0:d.response)==null?void 0:u.data)==null?void 0:h.message)||"failed")}},C=()=>{const p=o.mrTextLink.reduce((u,h)=>{const{title:d,...v}=h,m=u.find(k=>k.title===d);return m?m.content.push(v):u.push({title:h.title,content:[v]}),u},[]);r.saveMrRecords(p)},T=()=>{r.copyMrRecords(o.mrTextLink)};return(p,u)=>{const h=c("a-select"),d=c("a-form-item"),v=c("a-button"),m=c("a-spin"),k=c("a-form"),S=c("a-divider"),w=c("a-card"),q=c("a-alert");return R(n)?(g(),L("div",ye,[e(k,{model:o,onFinish:U},{default:s(()=>[(g(!0),L(E,null,A(o.mrList,(_,M)=>(g(),L("div",{class:"item",key:M},[e(d,{name:["mrList",M,"repoId"],rules:[{required:!0,message:"Repo is required!"}]},{default:s(()=>[e(h,{"show-search":"",placeholder:"Select a repo",value:_.repoId,"onUpdate:value":x=>_.repoId=x,options:R(t),"filter-option":i,onChange:x=>$(M)},null,8,["value","onUpdate:value","options","onChange"])]),_:2},1032,["name"]),e(d,{name:["mrList",M,"sourceBranch"],rules:[{required:!0,message:"SourceBranch is required!"}]},{default:s(()=>[e(h,{"show-search":"",placeholder:"Select sourceBranch",value:_.sourceBranch,"onUpdate:value":x=>_.sourceBranch=x,loading:_.loading,options:_.branchOptions,"filter-option":y},null,8,["value","onUpdate:value","loading","options"])]),_:2},1032,["name"]),e(d,{name:["mrList",M,"targetBranch"],rules:[{required:!0,message:"TargetBranch is required!"}]},{default:s(()=>[e(h,{mode:"multiple",placeholder:"Select targetBranch",value:_.targetBranch,"onUpdate:value":x=>_.targetBranch=x,loading:_.loading,options:_.branchOptions,"filter-option":y},null,8,["value","onUpdate:value","loading","options"])]),_:2},1032,["name"]),e(d,{class:"action"},{default:s(()=>[e(R(ge),{onClick:x=>b(M)},null,8,["onClick"])]),_:2},1024)]))),128)),e(d,null,{default:s(()=>[e(v,{type:"dashed",onClick:B},{default:s(()=>[I("Add")]),_:1})]),_:1}),e(d,{name:"assigneeIds",rules:[{required:!0,message:"Assignee is required!"}]},{default:s(()=>[e(h,{class:"select-assignee",mode:"multiple",placeholder:"Select Assignee",value:o.assigneeIds,"onUpdate:value":u[0]||(u[0]=_=>o.assigneeIds=_),options:o.userList,"field-names":{label:"username",value:"id"},"filter-option":!1,"not-found-content":o.fetching?void 0:null,onSearch:R(f)},ae({_:2},[o.fetching?{name:"notFoundContent",fn:s(()=>[e(m,{size:"small"})]),key:"0"}:void 0]),1032,["value","options","not-found-content","onSearch"])]),_:1}),e(d,null,{default:s(()=>[e(v,{type:"primary","html-type":"submit",loading:o.btnLoading},{default:s(()=>[I(" Create MR ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),o.mrTextLink.length?(g(),P(w,{key:0,title:"MR Text Link"},{extra:s(()=>[e(v,{onClick:T},{default:s(()=>[I("Copy")]),_:1}),e(S,{type:"vertical"}),e(v,{type:"primary",onClick:C},{default:s(()=>[I("Save")]),_:1})]),default:s(()=>[(g(!0),L(E,null,A(o.mrTextLink,(_,M)=>(g(),L("span",{key:M},[I(G(`[${_.targetBranch}]${_.projectName}`)+": ",1),N("a",{href:_.webUrl,target:"_blank"},G(_.webUrl),9,be),ke]))),128))]),_:1})):X("",!0)])):(g(),P(q,{key:1,type:"warning",message:"Please fill your Gitlab host and token in Settings page first!"}))}}});const Re=V(Se,[["__scopeId","data-v-2a816531"]]),Ce=a=>(z("data-v-7a0df396"),a=a(),J(),a),Me={key:0},Le=["onClick"],Ie=Ce(()=>N("a",null,"Delete",-1)),we=j({__name:"MyRepo",setup(a){const r=[{title:"Repo ID",dataIndex:"id",key:"id"},{title:"Repo Name",dataIndex:"name",key:"name"},{title:"Action",key:"action"}],n=O(),{repoList:l}=F(n),t=H({visible:!1,repoState:{id:null,name:""},isEdit:!1,editIndex:0}),i=()=>{t.repoState={id:null,name:""},t.isEdit=!1},y=()=>{t.isEdit?l.value.splice(t.editIndex,1,t.repoState):l.value.push(t.repoState),localStorage.setItem(Y,JSON.stringify(l.value)),t.visible=!1,i()},o=(b,f)=>{t.repoState=JSON.parse(JSON.stringify(b)),t.editIndex=f,t.visible=!0,t.isEdit=!0},$=b=>{l.value.splice(b,1),localStorage.setItem(Y,JSON.stringify(l.value))},B=b=>{t.repoState.id=+b.target.value};return(b,f)=>{const U=c("a-button"),C=c("a-divider"),T=c("a-popconfirm"),p=c("a-table"),u=c("a-input"),h=c("a-form-item"),d=c("a-form"),v=c("a-modal");return g(),L(E,null,[e(U,{type:"primary",onClick:f[0]||(f[0]=m=>t.visible=!0)},{default:s(()=>[I("Add Repo")]),_:1}),e(p,{class:"repo-list",columns:r,"data-source":R(l)},{bodyCell:s(({column:m,record:k,index:S})=>[m.key==="action"?(g(),L("span",Me,[N("a",{onClick:w=>o(k,S)},"Edit",8,Le),e(C,{type:"vertical"}),e(T,{title:"Are you sure delete this repo?","ok-text":"Yes","cancel-text":"No",onConfirm:w=>$(S)},{default:s(()=>[Ie]),_:2},1032,["onConfirm"])])):X("",!0)]),_:1},8,["data-source"]),e(v,{title:`${t.isEdit?"Edit":"Add"} Repo`,visible:t.visible,"onUpdate:visible":f[2]||(f[2]=m=>t.visible=m),onOk:y,onCancel:i},{default:s(()=>[e(d,{model:t.repoState,name:"settings",layout:"vertical",autocomplete:"off"},{default:s(()=>[e(h,{label:"Repo ID",name:"id",rules:[{required:!0,message:"Please input your Repo ID!"}]},{default:s(()=>[e(u,{type:"number",value:t.repoState.id,onChange:B},null,8,["value"])]),_:1}),e(h,{label:"Repo Name",name:"name",rules:[{required:!0,message:"Please input your Repo Name!"}]},{default:s(()=>[e(u,{value:t.repoState.name,"onUpdate:value":f[1]||(f[1]=m=>t.repoState.name=m)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","visible"])],64)}}});const Oe=V(we,[["__scopeId","data-v-7a0df396"]]),$e=j({__name:"Settings",setup(a){const r=O(),n=H({host:r.host,token:r.token}),l=t=>{r.saveSettings(t)};return(t,i)=>{const y=c("a-input"),o=c("a-form-item"),$=c("a-input-password"),B=c("a-button"),b=c("a-form");return g(),P(b,{model:n,name:"settings",layout:"vertical",autocomplete:"off",onFinish:l},{default:s(()=>[e(o,{label:"Host",name:"host",rules:[{required:!0,message:"Please input your Host!"}]},{default:s(()=>[e(y,{value:n.host,"onUpdate:value":i[0]||(i[0]=f=>n.host=f),placeholder:"Gitlab Instance Host URL"},null,8,["value"])]),_:1}),e(o,{label:"Token",name:"token",rules:[{required:!0,message:"Please input your Token!"}]},{default:s(()=>[e($,{value:n.token,"onUpdate:value":i[1]||(i[1]=f=>n.token=f),placeholder:"Personal Access Token"},null,8,["value"])]),_:1}),e(o,null,{default:s(()=>[e(B,{type:"primary","html-type":"submit"},{default:s(()=>[I("Save")]),_:1})]),_:1})]),_:1},8,["model"])}}}),Be=a=>(z("data-v-ea6c53c2"),a=a(),J(),a),xe=["href"],Ue=Be(()=>N("br",null,null,-1)),Pe=j({__name:"MrRecords",setup(a){const r=O(),{mrRecords:n}=F(r),l=i=>{ne.confirm({title:"Do you want to delete this record?",icon:e(oe),content:e("div",{style:"color:red;"},n.value[i].title),onOk(){r.deleteMrRecords(i)}})},t=i=>{r.copyMrRecords(n.value[i].content)};return(i,y)=>{const o=c("a-button"),$=c("a-divider"),B=c("a-card"),b=c("a-alert");return R(n).length?(g(!0),L(E,{key:0},A(R(n),(f,U)=>(g(),P(B,{key:f.title,title:f.title},{extra:s(()=>[e(o,{onClick:C=>t(U)},{default:s(()=>[I("Copy")]),_:2},1032,["onClick"]),e($,{type:"vertical"}),e(o,{type:"primary",danger:"",onClick:C=>l(U)},{default:s(()=>[I(" Delete ")]),_:2},1032,["onClick"])]),default:s(()=>[(g(!0),L(E,null,A(f.content,(C,T)=>(g(),L("span",{key:T},[I(G(`[${C.targetBranch}]${C.projectName}`)+": ",1),N("a",{href:C.webUrl,target:"_blank"},G(C.webUrl),9,xe),Ue]))),128))]),_:2},1032,["title"]))),128)):(g(),P(b,{key:1,type:"info",message:"Have no records, you can click save button in MR Text Link to save records to here!"}))}}});const Ne=V(Pe,[["__scopeId","data-v-ea6c53c2"]]),qe=j({__name:"Git",setup(a){const r=O(),n=se("CreateMR");return W(()=>{r.initApi()}),(l,t)=>{const i=c("a-tab-pane"),y=c("a-tabs");return g(),P(y,{activeKey:n.value,"onUpdate:activeKey":t[0]||(t[0]=o=>n.value=o)},{default:s(()=>[e(i,{key:"CreateMR",tab:"Create MR"},{default:s(()=>[e(R(Re))]),_:1}),e(i,{key:"MrRecords",tab:"MR Records"},{default:s(()=>[e(R(Ne))]),_:1}),e(i,{key:"MyRepo",tab:"My Repo"},{default:s(()=>[e(R(Oe))]),_:1}),e(i,{key:"Settings",tab:"Settings"},{default:s(()=>[e(R($e))]),_:1})]),_:1},8,["activeKey"])}}});export{qe as default};
