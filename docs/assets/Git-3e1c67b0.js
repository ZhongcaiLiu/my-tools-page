import{k as B,a as e,A as W,d as N,s as G,l as X,m as D,n as Y,b as c,f as C,o as h,c as L,w as o,F as q,e as T,g as O,q as Z,h as x,v as V,x as E,t as j,i as U,p as K,j as Q,_ as F,R as z,r as ee,y as te}from"./index-ae114f29.js";const ae=async(s,r={})=>{let a=[],l=1;const t=100;try{const _=async()=>{const b=await s({...r,page:l,perPage:t});return a=a.concat(b),b.length<t?a:(l++,await _())};await _()}catch(_){console.error(`${s} error`,_)}return a};B();const ne=B(),oe=async s=>{const{id:r,...a}=s;return(await ne.api.get(`/projects/${r}/repository/branches`,{params:a})).data},se=s=>ae(oe,{id:s}),re=B(),le=async s=>(await re.api.get(`/users?search=${s}`)).data,ie=B(),ce=async s=>{const{id:r,...a}=s;return(await ie.api.post(`/projects/${r}/merge_requests`,a)).data};var ue={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"};const de=ue;function J(s){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?Object(arguments[r]):{},l=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(t){return Object.getOwnPropertyDescriptor(a,t).enumerable}))),l.forEach(function(t){pe(s,t,a[t])})}return s}function pe(s,r,a){return r in s?Object.defineProperty(s,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):s[r]=a,s}var H=function(r,a){var l=J({},r,a.attrs);return e(W,J({},l,{icon:de}),null)};H.displayName="MinusCircleOutlined";H.inheritAttrs=!1;const _e=H,me=s=>(K("data-v-41dd2205"),s=s(),Q(),s),fe={key:0,class:"mr-page"},ge=["href"],he=me(()=>U("br",null,null,-1)),ve=N({__name:"CreateMR",setup(s){const r=B(),{hasAuth:a,repoList:l}=G(r),t=X(()=>l.value.map(d=>({value:d.id,label:d.name}))),_=(d,i)=>i.label.toLowerCase().indexOf(d.toLowerCase())>=0,b=(d,i)=>i.value.toLowerCase().indexOf(d.toLowerCase())>=0,n=D({mrList:[{repoId:void 0,sourceBranch:void 0,targetBranch:["master","uat"],branchOptions:[],loading:!1}],assigneeIds:[],userList:[],fetching:!1,mrTextLink:[],btnLoading:!1}),$=async d=>{const i=n.mrList[d];if(i.loading=!0,i!=null&&i.repoId){const u=(await se(i.repoId)).map(g=>({...g,value:g.name}));i.loading=!1,n.mrList.splice(d,1,{...i,branchOptions:u})}},I=()=>{n.mrList.push({repoId:void 0,sourceBranch:void 0,targetBranch:["master","uat"],branchOptions:[],loading:!1})},y=d=>{n.mrList.splice(d,1)},m=Y.debounce(async d=>{n.fetching=!0,n.userList=await le(d),n.fetching=!1},300),P=async()=>{var i,v;if(!n.mrList.length){E.error("Please input the MR!");return}n.btnLoading=!0;const d=[];n.mrList.forEach(u=>{const{repoId:g,sourceBranch:f="",targetBranch:k}=u;let S=f;{const[M,p]=f.split("/").slice(-2);S=`[${M}] ${p.split("-").join(" ")}`}k.forEach(M=>{d.push(ce({id:g,sourceBranch:f,targetBranch:M,title:S,assigneeIds:n.assigneeIds}))})});try{const u=await Promise.all(d);u.sort((g,f)=>{const k=g.targetBranch.toUpperCase(),S=f.targetBranch.toUpperCase();return k<S?-1:k>S?1:0}),n.mrTextLink=u.map(g=>{var R;const{title:f,targetBranch:k,projectId:S,webUrl:M}=g,p=(R=l.value.find(w=>w.id===S))==null?void 0:R.name;return{title:f,targetBranch:k,projectName:p,webUrl:M}}),n.btnLoading=!1,E.success("Create MR success!")}catch(u){E.error(((v=(i=u==null?void 0:u.response)==null?void 0:i.data)==null?void 0:v.message)||"failed")}},A=()=>{const d=n.mrTextLink.reduce((i,v)=>{const{title:u,...g}=v,f=i.find(k=>k.title===u);return f?f.content.push(g):i.push({title:v.title,content:[g]}),i},[]);r.saveMrRecords(d)};return(d,i)=>{const v=c("a-select"),u=c("a-form-item"),g=c("a-button"),f=c("a-spin"),k=c("a-form"),S=c("a-card"),M=c("a-alert");return C(a)?(h(),L("div",fe,[e(k,{model:n,onFinish:P},{default:o(()=>[(h(!0),L(q,null,T(n.mrList,(p,R)=>(h(),L("div",{class:"item",key:R},[e(u,{name:["mrList",R,"repoId"],rules:[{required:!0,message:"Repo is required!"}]},{default:o(()=>[e(v,{"show-search":"",placeholder:"Select a repo",value:p.repoId,"onUpdate:value":w=>p.repoId=w,options:C(t),"filter-option":_,onChange:w=>$(R)},null,8,["value","onUpdate:value","options","onChange"])]),_:2},1032,["name"]),e(u,{name:["mrList",R,"sourceBranch"],rules:[{required:!0,message:"SourceBranch is required!"}]},{default:o(()=>[e(v,{"show-search":"",placeholder:"Select sourceBranch",value:p.sourceBranch,"onUpdate:value":w=>p.sourceBranch=w,loading:p.loading,options:p.branchOptions,"filter-option":b},null,8,["value","onUpdate:value","loading","options"])]),_:2},1032,["name"]),e(u,{name:["mrList",R,"targetBranch"],rules:[{required:!0,message:"TargetBranch is required!"}]},{default:o(()=>[e(v,{mode:"multiple",placeholder:"Select targetBranch",value:p.targetBranch,"onUpdate:value":w=>p.targetBranch=w,loading:p.loading,options:p.branchOptions,"filter-option":b},null,8,["value","onUpdate:value","loading","options"])]),_:2},1032,["name"]),e(u,{class:"action"},{default:o(()=>[e(C(_e),{onClick:w=>y(R)},null,8,["onClick"])]),_:2},1024)]))),128)),e(u,null,{default:o(()=>[e(g,{type:"dashed",onClick:I},{default:o(()=>[O("Add")]),_:1})]),_:1}),e(u,{name:"assigneeIds",rules:[{required:!0,message:"Assignee is required!"}]},{default:o(()=>[e(v,{class:"select-assignee",mode:"multiple",placeholder:"Select Assignee",value:n.assigneeIds,"onUpdate:value":i[0]||(i[0]=p=>n.assigneeIds=p),options:n.userList,"field-names":{label:"username",value:"id"},"filter-option":!1,"not-found-content":n.fetching?void 0:null,onSearch:C(m)},Z({_:2},[n.fetching?{name:"notFoundContent",fn:o(()=>[e(f,{size:"small"})]),key:"0"}:void 0]),1032,["value","options","not-found-content","onSearch"])]),_:1}),e(u,null,{default:o(()=>[e(g,{type:"primary","html-type":"submit",loading:n.btnLoading},{default:o(()=>[O(" Create MR ")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),n.mrTextLink.length?(h(),x(S,{key:0,title:"MR Text Link"},{extra:o(()=>[e(g,{type:"primary",onClick:A},{default:o(()=>[O("Save")]),_:1})]),default:o(()=>[(h(!0),L(q,null,T(n.mrTextLink,(p,R)=>(h(),L("span",{key:R},[O(j(`[${p.targetBranch}]${p.projectName}`)+": ",1),U("a",{href:p.webUrl,target:"_blank"},j(p.webUrl),9,ge),he]))),128))]),_:1})):V("",!0)])):(h(),x(M,{key:1,type:"warning",message:"Please fill your Gitlab host and token in Settings page first!"}))}}});const be=F(ve,[["__scopeId","data-v-41dd2205"]]),ye={key:0},ke=["onClick"],Se=["onClick"],Re=N({__name:"MyRepo",setup(s){const r=[{title:"Repo ID",dataIndex:"id",key:"id"},{title:"Repo Name",dataIndex:"name",key:"name"},{title:"Action",key:"action"}],a=B(),{repoList:l}=G(a),t=D({visible:!1,repoState:{id:null,name:""},isEdit:!1,editIndex:0}),_=()=>{t.repoState={id:null,name:""},t.isEdit=!1},b=()=>{t.isEdit?l.value.splice(t.editIndex,1,t.repoState):l.value.push(t.repoState),localStorage.setItem(z,JSON.stringify(l.value)),t.visible=!1,_()},n=(y,m)=>{t.repoState=JSON.parse(JSON.stringify(y)),t.editIndex=m,t.visible=!0,t.isEdit=!0},$=y=>{l.value.splice(y,1),localStorage.setItem(z,JSON.stringify(l.value))},I=y=>{t.repoState.id=+y.target.value};return(y,m)=>{const P=c("a-button"),A=c("a-divider"),d=c("a-table"),i=c("a-input"),v=c("a-form-item"),u=c("a-form"),g=c("a-modal");return h(),L(q,null,[e(P,{type:"primary",onClick:m[0]||(m[0]=f=>t.visible=!0)},{default:o(()=>[O("Add Repo")]),_:1}),e(d,{class:"repo-list",columns:r,"data-source":C(l)},{bodyCell:o(({column:f,record:k,index:S})=>[f.key==="action"?(h(),L("span",ye,[U("a",{onClick:M=>n(k,S)},"Edit",8,ke),e(A,{type:"vertical"}),U("a",{onClick:M=>$(S)},"Delete",8,Se)])):V("",!0)]),_:1},8,["data-source"]),e(g,{title:`${t.isEdit?"Edit":"Add"} Repo`,visible:t.visible,"onUpdate:visible":m[2]||(m[2]=f=>t.visible=f),onOk:b,onCancel:_},{default:o(()=>[e(u,{model:t.repoState,name:"settings",layout:"vertical",autocomplete:"off"},{default:o(()=>[e(v,{label:"Repo ID",name:"id",rules:[{required:!0,message:"Please input your Repo ID!"}]},{default:o(()=>[e(i,{type:"number",value:t.repoState.id,onChange:I},null,8,["value"])]),_:1}),e(v,{label:"Repo Name",name:"name",rules:[{required:!0,message:"Please input your Repo Name!"}]},{default:o(()=>[e(i,{value:t.repoState.name,"onUpdate:value":m[1]||(m[1]=f=>t.repoState.name=f)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","visible"])],64)}}});const Ce=F(Re,[["__scopeId","data-v-70b7cd84"]]),Le=N({__name:"Settings",setup(s){const r=B(),a=D({host:r.host,token:r.token}),l=t=>{r.saveSettings(t)};return(t,_)=>{const b=c("a-input"),n=c("a-form-item"),$=c("a-input-password"),I=c("a-button"),y=c("a-form");return h(),x(y,{model:a,name:"settings",layout:"vertical",autocomplete:"off",onFinish:l},{default:o(()=>[e(n,{label:"Host",name:"host",rules:[{required:!0,message:"Please input your Host!"}]},{default:o(()=>[e(b,{value:a.host,"onUpdate:value":_[0]||(_[0]=m=>a.host=m),placeholder:"Gitlab Instance Host URL"},null,8,["value"])]),_:1}),e(n,{label:"Token",name:"token",rules:[{required:!0,message:"Please input your Token!"}]},{default:o(()=>[e($,{value:a.token,"onUpdate:value":_[1]||(_[1]=m=>a.token=m),placeholder:"Personal Access Token"},null,8,["value"])]),_:1}),e(n,null,{default:o(()=>[e(I,{type:"primary","html-type":"submit"},{default:o(()=>[O("Save")]),_:1})]),_:1})]),_:1},8,["model"])}}}),Ie=s=>(K("data-v-cbf5253b"),s=s(),Q(),s),Me=["href"],we=Ie(()=>U("br",null,null,-1)),Be=N({__name:"MrRecords",setup(s){const r=B(),{mrRecords:a}=G(r),l=t=>{r.deleteMrRecords(t)};return(t,_)=>{const b=c("a-button"),n=c("a-card"),$=c("a-alert");return C(a).length?(h(!0),L(q,{key:0},T(C(a),(I,y)=>(h(),x(n,{key:I.title,title:I.title},{extra:o(()=>[e(b,{type:"primary",danger:"",onClick:m=>l(y)},{default:o(()=>[O(" Delete ")]),_:2},1032,["onClick"])]),default:o(()=>[(h(!0),L(q,null,T(I.content,(m,P)=>(h(),L("span",{key:P},[O(j(`[${m.targetBranch}]${m.projectName}`)+": ",1),U("a",{href:m.webUrl,target:"_blank"},j(m.webUrl),9,Me),we]))),128))]),_:2},1032,["title"]))),128)):(h(),x($,{key:1,type:"info",message:"Have no records, you can click save button in MR Text Link to save records to here!"}))}}});const Oe=F(Be,[["__scopeId","data-v-cbf5253b"]]),xe=N({__name:"Git",setup(s){const r=B(),a=ee("CreateMR");return te(()=>{r.initApi()}),(l,t)=>{const _=c("a-tab-pane"),b=c("a-tabs");return h(),x(b,{activeKey:a.value,"onUpdate:activeKey":t[0]||(t[0]=n=>a.value=n)},{default:o(()=>[e(_,{key:"CreateMR",tab:"Create MR"},{default:o(()=>[e(C(be))]),_:1}),e(_,{key:"MrRecords",tab:"MR Records"},{default:o(()=>[e(C(Oe))]),_:1}),e(_,{key:"MyRepo",tab:"My Repo"},{default:o(()=>[e(C(Ce))]),_:1}),e(_,{key:"Settings",tab:"Settings"},{default:o(()=>[e(C(Le))]),_:1})]),_:1},8,["activeKey"])}}});export{xe as default};
