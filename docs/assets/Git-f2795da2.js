import{k as O,a as e,A as V,d as U,s as z,l as K,m as A,n as Q,b as u,f as I,o as y,c as w,w as r,F as j,e as T,g as $,q as W,h as P,v as H,x as N,t as G,i as x,p as X,j as Y,_ as J,R as D,r as Z,y as ee}from"./index-e1a6c23a.js";const te=async(o,s={})=>{let a=[],i=1;const t=100;try{const _=async()=>{const v=await o({...s,page:i,perPage:t});return a=a.concat(v),v.length<t?a:(i++,await _())};await _()}catch(_){console.error(`${o} error`,_)}return a};O();const ae=O(),ne=async o=>{const{id:s,...a}=o;return(await ae.api.get(`/projects/${s}/repository/branches`,{params:a})).data},oe=o=>te(ne,{id:o}),se=O(),re=async o=>(await se.api.get(`/users?search=${o}`)).data,le=O(),ie=async o=>{const{id:s,...a}=o;return(await le.api.post(`/projects/${s}/merge_requests`,a)).data};var ce={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"};const ue=ce;function F(o){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?Object(arguments[s]):{},i=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(a).filter(function(t){return Object.getOwnPropertyDescriptor(a,t).enumerable}))),i.forEach(function(t){de(o,t,a[t])})}return o}function de(o,s,a){return s in o?Object.defineProperty(o,s,{value:a,enumerable:!0,configurable:!0,writable:!0}):o[s]=a,o}var E=function(s,a){var i=F({},s,a.attrs);return e(V,F({},i,{icon:ue}),null)};E.displayName="MinusCircleOutlined";E.inheritAttrs=!1;const pe=E,_e=o=>(X("data-v-f9d8e394"),o=o(),Y(),o),me={key:0,class:"mr-page"},fe=["href"],ge=_e(()=>x("br",null,null,-1)),ve=U({__name:"CreateMR",setup(o){const s=O(),{hasAuth:a,repoList:i}=z(s),t=K(()=>i.value.map(d=>({value:d.id,label:d.name}))),_=(d,p)=>p.label.toLowerCase().indexOf(d.toLowerCase())>=0,v=(d,p)=>p.value.toLowerCase().indexOf(d.toLowerCase())>=0,n=A({mrList:[{repoId:void 0,sourceBranch:void 0,targetBranch:["master","uat"],branchOptions:[],loading:!1}],assigneeIds:[],userList:[],fetching:!1,mrTextLink:[]}),B=async d=>{const p=n.mrList[d];if(p.loading=!0,p!=null&&p.repoId){const c=(await oe(p.repoId)).map(f=>({...f,value:f.name}));p.loading=!1,n.mrList.splice(d,1,{...p,branchOptions:c})}},M=()=>{n.mrList.push({repoId:void 0,sourceBranch:void 0,targetBranch:["master","uat"],branchOptions:[],loading:!1})},S=d=>{n.mrList.splice(d,1)},m=Q.debounce(async d=>{n.fetching=!0,n.userList=await re(d),n.fetching=!1},300),q=async()=>{var p,h;if(!n.mrList.length){N.error("Please input the MR!");return}const d=[];n.mrList.forEach(c=>{const{repoId:f,sourceBranch:b="",targetBranch:g}=c;let R=b;{const[k,l]=b.split("/").slice(-2);R=`[${k}] ${l.split("-").join(" ")}`}g.forEach(k=>{d.push(ie({id:f,sourceBranch:b,targetBranch:k,title:R,assigneeIds:n.assigneeIds}))})});try{const c=await Promise.all(d);N.success("Create MR success!"),c.sort((f,b)=>f.targetBranch-b.targetBranch),n.mrTextLink=c.map(f=>{var l;const{targetBranch:b,projectId:g,webUrl:R}=f,k=(l=i.value.find(C=>C.id===g))==null?void 0:l.name;return{targetBranch:b,projectName:k,webUrl:R}})}catch(c){N.error(((h=(p=c==null?void 0:c.response)==null?void 0:p.data)==null?void 0:h.message)||"failed")}};return(d,p)=>{const h=u("a-select"),c=u("a-form-item"),f=u("a-button"),b=u("a-spin"),g=u("a-form"),R=u("a-card"),k=u("a-alert");return I(a)?(y(),w("div",me,[e(g,{model:n,onFinish:q},{default:r(()=>[(y(!0),w(j,null,T(n.mrList,(l,C)=>(y(),w("div",{class:"item",key:C},[e(c,{name:["mrList",C,"repoId"],rules:[{required:!0,message:"Repo is required!"}]},{default:r(()=>[e(h,{"show-search":"",placeholder:"Select a repo",value:l.repoId,"onUpdate:value":L=>l.repoId=L,options:I(t),"filter-option":_,onChange:L=>B(C)},null,8,["value","onUpdate:value","options","onChange"])]),_:2},1032,["name"]),e(c,{name:["mrList",C,"sourceBranch"],rules:[{required:!0,message:"SourceBranch is required!"}]},{default:r(()=>[e(h,{"show-search":"",placeholder:"Select sourceBranch",value:l.sourceBranch,"onUpdate:value":L=>l.sourceBranch=L,loading:l.loading,options:l.branchOptions,"filter-option":v},null,8,["value","onUpdate:value","loading","options"])]),_:2},1032,["name"]),e(c,{name:["mrList",C,"targetBranch"],rules:[{required:!0,message:"TargetBranch is required!"}]},{default:r(()=>[e(h,{mode:"multiple",placeholder:"Select targetBranch",value:l.targetBranch,"onUpdate:value":L=>l.targetBranch=L,loading:l.loading,options:l.branchOptions,"filter-option":v},null,8,["value","onUpdate:value","loading","options"])]),_:2},1032,["name"]),e(c,{class:"action"},{default:r(()=>[e(I(pe),{onClick:L=>S(C)},null,8,["onClick"])]),_:2},1024)]))),128)),e(c,null,{default:r(()=>[e(f,{type:"dashed",onClick:M},{default:r(()=>[$("Add")]),_:1})]),_:1}),e(c,{name:"assigneeIds",rules:[{required:!0,message:"Assignee is required!"}]},{default:r(()=>[e(h,{class:"select-assignee",mode:"multiple",placeholder:"Select Assignee",value:n.assigneeIds,"onUpdate:value":p[0]||(p[0]=l=>n.assigneeIds=l),options:n.userList,"field-names":{label:"username",value:"id"},"filter-option":!1,"not-found-content":n.fetching?void 0:null,onSearch:I(m)},W({_:2},[n.fetching?{name:"notFoundContent",fn:r(()=>[e(b,{size:"small"})]),key:"0"}:void 0]),1032,["value","options","not-found-content","onSearch"])]),_:1}),e(c,null,{default:r(()=>[e(f,{type:"primary","html-type":"submit"},{default:r(()=>[$("Create MR")]),_:1})]),_:1})]),_:1},8,["model"]),n.mrTextLink.length?(y(),P(R,{key:0,title:"MR Text Link"},{default:r(()=>[(y(!0),w(j,null,T(n.mrTextLink,(l,C)=>(y(),w("span",{key:C},[$(G(`[${l.targetBranch}]${l.projectName}`)+": ",1),x("a",{href:l.webUrl,target:"_blank"},G(l.webUrl),9,fe),ge]))),128))]),_:1})):H("",!0)])):(y(),P(k,{key:1,type:"warning",message:"Please fill your Gitlab host and token in Settings page first!"}))}}});const he=J(ve,[["__scopeId","data-v-f9d8e394"]]),be={key:0},ye=["onClick"],Se=["onClick"],ke=U({__name:"MyRepo",setup(o){const s=[{title:"Repo ID",dataIndex:"id",key:"id"},{title:"Repo Name",dataIndex:"name",key:"name"},{title:"Action",key:"action"}],a=O(),{repoList:i}=z(a),t=A({visible:!1,repoState:{id:null,name:""},isEdit:!1,editIndex:0}),_=()=>{t.repoState={id:null,name:""},t.isEdit=!1},v=()=>{t.isEdit?i.value.splice(t.editIndex,1,t.repoState):i.value.push(t.repoState),localStorage.setItem(D,JSON.stringify(i.value)),t.visible=!1,_()},n=(S,m)=>{t.repoState=JSON.parse(JSON.stringify(S)),t.editIndex=m,t.visible=!0,t.isEdit=!0},B=S=>{i.value.splice(S,1),localStorage.setItem(D,JSON.stringify(i.value))},M=S=>{t.repoState.id=+S.target.value};return(S,m)=>{const q=u("a-button"),d=u("a-divider"),p=u("a-table"),h=u("a-input"),c=u("a-form-item"),f=u("a-form"),b=u("a-modal");return y(),w(j,null,[e(q,{type:"primary",onClick:m[0]||(m[0]=g=>t.visible=!0)},{default:r(()=>[$("Add Repo")]),_:1}),e(p,{class:"repo-list",columns:s,"data-source":I(i)},{bodyCell:r(({column:g,record:R,index:k})=>[g.key==="action"?(y(),w("span",be,[x("a",{onClick:l=>n(R,k)},"Edit",8,ye),e(d,{type:"vertical"}),x("a",{onClick:l=>B(k)},"Delete",8,Se)])):H("",!0)]),_:1},8,["data-source"]),e(b,{title:`${t.isEdit?"Edit":"Add"} Repo`,visible:t.visible,"onUpdate:visible":m[2]||(m[2]=g=>t.visible=g),onOk:v,onCancel:_},{default:r(()=>[e(f,{model:t.repoState,name:"settings",layout:"vertical",autocomplete:"off"},{default:r(()=>[e(c,{label:"Repo ID",name:"id",rules:[{required:!0,message:"Please input your Repo ID!"}]},{default:r(()=>[e(h,{type:"number",value:t.repoState.id,onChange:M},null,8,["value"])]),_:1}),e(c,{label:"Repo Name",name:"name",rules:[{required:!0,message:"Please input your Repo Name!"}]},{default:r(()=>[e(h,{value:t.repoState.name,"onUpdate:value":m[1]||(m[1]=g=>t.repoState.name=g)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","visible"])],64)}}});const Ce=J(ke,[["__scopeId","data-v-9b07b28d"]]),Re=U({__name:"Settings",setup(o){const s=O(),a=A({host:s.host,token:s.token}),i=t=>{s.saveSettings(t)};return(t,_)=>{const v=u("a-input"),n=u("a-form-item"),B=u("a-input-password"),M=u("a-button"),S=u("a-form");return y(),P(S,{model:a,name:"settings",layout:"vertical",autocomplete:"off",onFinish:i},{default:r(()=>[e(n,{label:"Host",name:"host",rules:[{required:!0,message:"Please input your Host!"}]},{default:r(()=>[e(v,{value:a.host,"onUpdate:value":_[0]||(_[0]=m=>a.host=m),placeholder:"Gitlab Instance Host URL"},null,8,["value"])]),_:1}),e(n,{label:"Token",name:"token",rules:[{required:!0,message:"Please input your Token!"}]},{default:r(()=>[e(B,{value:a.token,"onUpdate:value":_[1]||(_[1]=m=>a.token=m),placeholder:"Personal Access Token"},null,8,["value"])]),_:1}),e(n,null,{default:r(()=>[e(M,{type:"primary","html-type":"submit"},{default:r(()=>[$("Save")]),_:1})]),_:1})]),_:1},8,["model"])}}}),Oe=U({__name:"Git",setup(o){const s=O(),a=Z("CreateMR");return ee(()=>{s.initApi()}),(i,t)=>{const _=u("a-tab-pane"),v=u("a-tabs");return y(),P(v,{activeKey:a.value,"onUpdate:activeKey":t[0]||(t[0]=n=>a.value=n)},{default:r(()=>[e(_,{key:"CreateMR",tab:"Create MR"},{default:r(()=>[e(I(he))]),_:1}),e(_,{key:"MyRepo",tab:"My Repo"},{default:r(()=>[e(I(Ce))]),_:1}),e(_,{key:"Settings",tab:"Settings"},{default:r(()=>[e(I(Re))]),_:1})]),_:1},8,["activeKey"])}}});export{Oe as default};
